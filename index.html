<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acca Master Pro</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --primary: #00ff88; --bg: #121212; --card: #1e1e1e; --text: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 80px; }
        h1 { font-size: 1.5rem; margin-bottom: 5px; color: var(--primary); }
        h2 { font-size: 1rem; color: #888; margin-top: 0; font-weight: normal; }
        
        /* Controls */
        .controls { margin-bottom: 20px; display: flex; gap: 10px; }
        button { background: var(--primary); color: #000; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; flex: 1; }
        button:disabled { opacity: 0.5; }
        
        /* Cards */
        .acca-card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .acca-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .acca-odds { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .acca-return { font-size: 0.9rem; color: #aaa; }
        
        .leg { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
        .leg-match { color: #fff; }
        .leg-bet { color: #ccc; font-size: 0.85rem; text-align: right; }
        
        .loading { text-align: center; color: #666; margin-top: 50px; display: none; }
        .install-btn { display: none; background: #333; color: #fff; margin-bottom: 20px; }
    </style>
</head>
<body>

    <button id="installBtn" class="install-btn">ðŸ“² Install App</button>

    <h1>Acca Master Pro</h1>
    <h2>Daily Value Generator</h2>

    <div class="controls">
        <button onclick="runAnalysis()">GENERATE ACCAS</button>
    </div>

    <div id="loading" class="loading">
        Analyzing historic form...<br>Calculating 4/1+ combinations...
    </div>

    <div id="results"></div>

    <script>
        // --- CONFIGURATION ---
        const API_KEY = 'PASTE_YOUR_KEY_HERE'; // <--- PASTE YOUR KEY HERE
        const MIN_ODDS = 5.0; // 4/1 fractional
        
        // --- PWA INSTALL LOGIC ---
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const btn = document.getElementById('installBtn');
            btn.style.display = 'block';
            btn.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((result) => {
                    if (result.outcome === 'accepted') btn.style.display = 'none';
                    deferredPrompt = null;
                });
            });
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js');
        }

        // --- APP LOGIC ---

        async function runAnalysis() {
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            
            resultsDiv.innerHTML = '';
            loadingDiv.style.display = 'block';

            try {
                // 1. Fetch Data (Mocking for now so you can test immediately)
                // In production, replace this with fetch('https://v3.football.api-sports.io/fixtures?date=...', headers...)
                const matches = await mockFetchData();

                // 2. Analyze & Filter
                const bestPicks = matches.filter(m => analyzeMatch(m));

                // 3. Generate Combinations (3-folds and 4-folds)
                const accas = [
                    ...generateCombinations(bestPicks, 3),
                    ...generateCombinations(bestPicks, 4)
                ];

                // 4. Render
                loadingDiv.style.display = 'none';
                if(accas.length === 0) {
                    resultsDiv.innerHTML = '<p style="text-align:center">No accumulators found meeting 4/1 odds criteria today.</p>';
                    return;
                }

                // Sort by highest odds
                accas.sort((a, b) => b.totalOdds - a.totalOdds);

                // Show top 20
                accas.slice(0, 20).forEach(acca => {
                    renderAccaCard(acca, resultsDiv);
                });

            } catch (error) {
                console.error(error);
                loadingDiv.innerText = "Error fetching data. Check API Key.";
            }
        }

        // --- THE BRAIN: ANALYSIS ENGINE ---
        
        function analyzeMatch(match) {
            // Simple Logic: 
            // We only want matches where a team has >50% recent win rate 
            // AND the odds are between 1.5 and 2.2 (Sweet spot for Accas)
            const homeForm = match.home_form_pct; 
            const awayForm = match.away_form_pct;
            const homeOdds = match.odds_home;

            // Strategy: Back Home Favorites with Good Form
            if (homeForm > 60 && homeOdds >= 1.4 && homeOdds <= 2.3) {
                match.prediction = "Home Win";
                match.selectedOdds = homeOdds;
                return true;
            }
            return false;
        }

        function generateCombinations(arr, k) {
            const results = [];
            
            function combine(start, combo) {
                if (combo.length === k) {
                    const totalOdds = combo.reduce((acc, match) => acc * match.selectedOdds, 1);
                    if (totalOdds >= MIN_ODDS) {
                        results.push({
                            matches: combo,
                            totalOdds: totalOdds.toFixed(2),
                            returnOn10: (totalOdds * 10).toFixed(2)
                        });
                    }
                    return;
                }
                for (let i = start; i < arr.length; i++) {
                    combine(i + 1, [...combo, arr[i]]);
                }
            }
            combine(0, []);
            return results;
        }

        function renderAccaCard(acca, container) {
            const card = document.createElement('div');
            card.className = 'acca-card';
            
            let legsHtml = acca.matches.map(m => `
                <div class="leg">
                    <span class="leg-match">${m.home} v ${m.away}</span>
                    <span class="leg-bet">${m.prediction} @ ${m.selectedOdds}</span>
                </div>
            `).join('');

            card.innerHTML = `
                <div class="acca-header">
                    <span class="acca-odds">${acca.matches.length}-Fold @ ${acca.totalOdds}</span>
                    <span class="acca-return">Returns Â£${acca.returnOn10}</span>
                </div>
                ${legsHtml}
            `;
            container.appendChild(card);
        }

        // --- DATA SIMULATION (Remove this and use real fetch for production) ---
        function mockFetchData() {
            return new Promise(resolve => {
                setTimeout(() => {
                    // Simulating a list of matches with form stats attached
                    const dummyData = [
                        { home: "Arsenal", away: "Brighton", home_form_pct: 80, odds_home: 1.7 },
                        { home: "Liverpool", away: "Chelsea", home_form_pct: 75, odds_home: 1.9 },
                        { home: "Man City", away: "Spurs", home_form_pct: 90, odds_home: 1.45 },
                        { home: "Villa", away: "Wolves", home_form_pct: 65, odds_home: 2.1 },
                        { home: "Newcastle", away: "Fulham", home_form_pct: 70, odds_home: 1.6 },
                        { home: "Everton", away: "Luton", home_form_pct: 55, odds_home: 2.0 },
                        { home: "Leeds", away: "Hull", home_form_pct: 60, odds_home: 1.8 }
                    ];
                    resolve(dummyData);
                }, 800);
            });
        }
    </script>
</body>
</html>
