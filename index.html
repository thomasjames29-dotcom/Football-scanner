<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InPlay God Mode Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öΩ</text></svg>">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0f172a; color: #e2e8f0; padding: 15px; padding-bottom: 80px; }
        h2 { text-align: center; color: #38bdf8; margin-bottom: 5px; font-weight: 800; letter-spacing: 1px; }
        
        /* Dashboard */
        .profit-board { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; background: #1e293b; padding: 10px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #334155; text-align: center; }
        .profit-stat { font-size: 0.9em; color: #94a3b8; }
        .profit-val { font-size: 1.2em; font-weight: bold; color: #fff; }
        .val-green { color: #4ade80; }
        .val-red { color: #f87171; }
        .btn-reset { grid-column: span 3; background: none; border: none; color: #64748b; font-size: 0.75em; cursor: pointer; margin-top: 5px; text-decoration: underline; }

        /* Controls */
        .controls { display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
        select { background: #1e293b; color: #fff; padding: 12px; border: 1px solid #475569; border-radius: 8px; font-size: 1em; width: 100%; font-weight: bold; appearance: none; }
        
        /* Buttons */
        .btn-scan { background: #8b5cf6; color: white; border: none; padding: 14px; border-radius: 12px; width: 100%; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .btn-history { background: #f59e0b; color: #000; border: none; padding: 10px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
        .btn-nav { background: #334155; color: #cbd5e1; border: 1px solid #475569; padding: 10px; border-radius: 8px; width: 100%; font-weight:bold; cursor: pointer; }
        .btn-schedule { background: #0f766e; color: #ccfbf1; border: 1px solid #115e59; padding: 10px; border-radius: 8px; width: 100%; font-weight:bold; cursor: pointer; }

        /* Card Styles */
        .card { background-color: #1e293b; padding: 15px; margin-bottom: 15px; border-radius: 12px; border-left: 6px solid #64748b; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2); position: relative; }
        .card.likelihood-High { border-left-color: #ef4444; } 
        .card.likelihood-Medium { border-left-color: #f59e0b; } 
        
        /* History Success Styles */
        .card.history-success { border: 2px solid #4ade80; background: #064e3b; }
        .history-tag { position: absolute; top: 10px; right: 10px; background: #4ade80; color: #064e3b; font-weight: bold; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; display: none; }
        .card.history-success .history-tag { display: block; }

        .match-header { display: flex; justify-content: space-between; align-items: center; color: #94a3b8; font-size: 0.85em; margin-bottom: 8px; }
        .star-rating { color: #fbbf24; letter-spacing: 2px; font-size: 1em; }
        .team-row { display: flex; align-items: center; justify-content: space-between; margin: 5px 0; font-size: 1.1em; font-weight: bold; }
        .team-info { display: flex; align-items: center; gap: 10px; }
        .team-logo { width: 28px; height: 28px; object-fit: contain; }
        .score { font-size: 1.3em; color: #fff; }

        /* Stats & Widgets */
        .tilt-container { height: 8px; background: #334155; border-radius: 4px; margin: 10px 0; overflow: hidden; display: flex; }
        .tilt-home { background: #3b82f6; height: 100%; transition: width 0.5s; }
        .tilt-away { background: #ef4444; height: 100%; transition: width 0.5s; }

        .advisor-box { background: #0f172a; padding: 10px; border-radius: 6px; font-size: 0.9em; text-align: center; color: #e2e8f0; border: 1px solid #334155; margin-bottom: 10px; display:flex; justify-content: space-around; align-items: center; }
        .market-tag { color: #2dd4bf; font-weight: bold; text-transform: uppercase; border: 1px solid #0f766e; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; }
        .stake-tag { color: #f472b6; font-weight: bold; }

        .tools-row { display: grid; grid-template-columns: 1fr 3fr 1fr 1fr; gap: 8px; margin-top: 12px; }
        .btn-tool { border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: #fff; font-size: 0.9em; padding: 8px 0; }
        .btn-copy { background: #334155; color: #cbd5e1; }
        .btn-bet { background: #047857; }
        .btn-win { background: #0f766e; }
        .btn-loss { background: #991b1b; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; background: #0f172a; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 12px; }
        .stat-item { display: flex; justify-content: space-between; }
        .stat-label { color: #64748b; }
        .highlight-stat { color: #fbbf24; font-weight: bold; }

        .badge-container { display: flex; gap: 5px; justify-content: center; margin-top: 8px; flex-wrap: wrap; }
        .badge { font-size: 0.75em; padding: 2px 8px; border-radius: 4px; font-weight: bold; text-transform: uppercase; }
        .badge-red { background: #ef4444; color: white; }
        .badge-yellow { background: #f59e0b; color: black; }
        .badge-blue { background: #3b82f6; color: white; }
        .badge-purple { background: #a855f7; color: white; }

        .error-msg { color: #fca5a5; background: #450a0a; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 15px; display: none; }
        .scan-status { text-align: center; color: #94a3b8; font-size: 0.9em; margin-bottom: 10px; font-style: italic; display: none; }
    </style>
</head>
<body>

    <h2>ü§ñ InPlay God Mode</h2>
    
    <div class="profit-board">
        <div><div class="profit-stat">Wins</div><div id="stat-wins" class="profit-val val-green">0</div></div>
        <div><div class="profit-stat">Losses</div><div id="stat-losses" class="profit-val val-red">0</div></div>
        <div><div class="profit-stat">Win Rate</div><div id="stat-rate" class="profit-val">0%</div></div>
        <button class="btn-reset" onclick="resetStats()">Reset Daily Stats</button>
    </div>

    <div id="error-display" class="error-msg"></div>
    <div id="scan-status" class="scan-status"></div>

    <div class="controls">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
            <a href="help.html" style="text-decoration:none;"><button class="btn-nav" style="width:100%">üìñ Guide</button></a>
            <button class="btn-history" onclick="viewHistory()">üìú History</button>
        </div>
        <button class="btn-schedule" onclick="checkSchedule()">üìÖ Check 70th Min Times</button>
        <select id="league-filter">
            <option value="major">‚≠ê Major Leagues (API Saver)</option>
            <option value="goals">‚öΩ Goal Machines (Dutch/Aus/Swiss)</option>
            <option value="all">üåç Scan World (High Data Usage)</option>
        </select>
        <button class="btn-scan" onclick="startScan()">üîç RUN SCAN</button>
    </div>
    
    <div id="results"></div>

    <script>
        const RAW_KEY = "0f29a2f96e9dd4231cee515cc5ec52b0"; 
        const API_KEY = RAW_KEY.trim(); 
        
        const resultsDiv = document.getElementById('results');
        const errorDiv = document.getElementById('error-display');
        const statusDiv = document.getElementById('scan-status');
        let audioCtx = null;
        window.MATCH_TIPS = {};

        const LEAGUES = {
            major: [2, 3, 39, 140, 78, 135, 61, 4, 144, 848, 40, 307],
            goals: [88, 103, 203, 188, 373, 206, 179, 180]
        };

        // --- STATS LOGIC ---
        function loadStats() {
            const wins = parseInt(localStorage.getItem('inplay_wins') || 0);
            const losses = parseInt(localStorage.getItem('inplay_losses') || 0);
            updateBoard(wins, losses);
        }
        function updateBoard(w, l) {
            document.getElementById('stat-wins').innerText = w;
            document.getElementById('stat-losses').innerText = l;
            const total = w + l;
            const rate = total === 0 ? 0 : Math.round((w / total) * 100);
            document.getElementById('stat-rate').innerText = rate + "%";
        }
        function recordResult(type) {
            let wins = parseInt(localStorage.getItem('inplay_wins') || 0);
            let losses = parseInt(localStorage.getItem('inplay_losses') || 0);
            if (type === 'win') wins++;
            if (type === 'loss') losses++;
            localStorage.setItem('inplay_wins', wins);
            localStorage.setItem('inplay_losses', losses);
            updateBoard(wins, losses);
        }
        function resetStats() {
            if(confirm("Reset stats and history?")) {
                localStorage.setItem('inplay_wins', 0);
                localStorage.setItem('inplay_losses', 0);
                localStorage.setItem('inplay_history', JSON.stringify([])); // Clear history too
                updateBoard(0, 0);
            }
        }
        loadStats();

        // --- HISTORY ENGINE ---
        function saveToHistory(match, market, stars) {
            let history = JSON.parse(localStorage.getItem('inplay_history') || "[]");
            // Check duplicate ID
            if(history.some(h => h.id === match.fixture.id)) return;

            history.push({
                id: match.fixture.id,
                home: match.teams.home.name,
                away: match.teams.away.name,
                homeLogo: match.teams.home.logo,
                awayLogo: match.teams.away.logo,
                scanScore: match.goals.home + match.goals.away, // Total goals at scan
                market: market,
                stars: stars,
                timestamp: new Date().toLocaleTimeString()
            });
            localStorage.setItem('inplay_history', JSON.stringify(history));
        }

        async function viewHistory() {
            const history = JSON.parse(localStorage.getItem('inplay_history') || "[]");
            if(history.length === 0) {
                resultsDiv.innerHTML = "<p style='text-align:center'>No scan history today.</p>";
                return;
            }

            resultsDiv.innerHTML = "<p style='text-align:center'>Updating match outcomes...</p>";
            
            // Batch Fetch current status
            const ids = history.map(h => h.id).join('-');
            try {
                const response = await fetch(`https://v3.football.api-sports.io/fixtures?ids=${ids}`, {
                    "method": "GET",
                    "headers": { "x-apisports-key": API_KEY }
                });
                const data = await response.json();
                const liveMatches = data.response;

                resultsDiv.innerHTML = "<h3>üìú Scan History (Success Check)</h3>";

                history.forEach(savedMatch => {
                    const currentMatch = liveMatches.find(m => m.fixture.id === savedMatch.id);
                    let status = "Checking...";
                    let finalScore = "N/A";
                    let isSuccess = false;

                    if(currentMatch) {
                        const currentTotal = currentMatch.goals.home + currentMatch.goals.away;
                        finalScore = `${currentMatch.goals.home}-${currentMatch.goals.away}`;
                        
                        // SUCCESS LOGIC: Goal scored AFTER scan
                        if(currentTotal > savedMatch.scanScore) {
                            isSuccess = true;
                            status = "GOAL SCORED ‚úÖ";
                        } else {
                            status = `Pending (${currentMatch.fixture.status.short})`;
                        }
                    }

                    const card = document.createElement('div');
                    card.className = `card ${isSuccess ? 'history-success' : ''}`;
                    card.innerHTML = `
                        <div class="history-tag">GOAL LANDED</div>
                        <div class="match-header"><span>${savedMatch.timestamp}</span><span>${savedMatch.stars}</span></div>
                        <div class="team-row"><div class="team-info"><img src="${savedMatch.homeLogo}" class="team-logo"> ${savedMatch.home}</div></div>
                        <div class="team-row"><div class="team-info"><img src="${savedMatch.awayLogo}" class="team-logo"> ${savedMatch.away}</div></div>
                        <div class="stats-grid" style="margin-top:10px;">
                            <div class="stat-item"><span class="stat-label">Market</span> <span class="highlight-stat">${savedMatch.market}</span></div>
                            <div class="stat-item"><span class="stat-label">Result</span> <span style="font-weight:bold; color:${isSuccess?'#4ade80':'#fff'}">${finalScore}</span></div>
                        </div>
                    `;
                    resultsDiv.appendChild(card);
                });

            } catch(e) {
                showError("Could not fetch history updates.");
            }
        }


        // --- CORE FUNCTIONS ---
        function playAlertSound() {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime); 
                oscillator.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.2); 
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.25);
            } catch(e) {}
        }

        function copyTip(fixtureId) {
            const text = window.MATCH_TIPS[fixtureId];
            if(text) navigator.clipboard.writeText(text).then(() => alert("Tip copied!"));
        }

        function showError(msg) {
            errorDiv.style.display = 'block';
            errorDiv.innerHTML = `‚ö†Ô∏è ${msg}`;
            statusDiv.style.display = 'none';
        }
        function updateStatus(msg) {
            statusDiv.style.display = 'block';
            statusDiv.innerText = msg;
        }

        // --- SCANNER ---
        async function startScan() {
            resultsDiv.innerHTML = "";
            errorDiv.style.display = 'none';
            updateStatus("Scanning live matches...");

            try {
                const response = await fetch("https://v3.football.api-sports.io/fixtures?live=all", {
                    "method": "GET",
                    "headers": { "x-apisports-key": API_KEY }
                });
                const data = await response.json();
                if (data.errors && Object.keys(data.errors).length > 0) { showError("Daily Limit Reached."); return; }

                let matches = data.response;
                if (!matches || matches.length === 0) { 
                    statusDiv.style.display = 'none';
                    resultsDiv.innerHTML = "<p style='text-align:center;'>No live games.</p>"; 
                    return; 
                }

                const filterType = document.getElementById('league-filter').value;
                if (filterType === 'major') matches = matches.filter(m => LEAGUES.major.includes(m.league.id) || m.league.type === 'Cup');
                else if (filterType === 'goals') matches = matches.filter(m => LEAGUES.goals.includes(m.league.id));

                let potentialTips = 0;
                for (let i = 0; i < matches.length; i++) {
                    const match = matches[i];
                    if (!match || !match.fixture || !match.goals) continue;
                    if (match.goals.home === null || match.goals.away === null) continue;

                    const elapsed = match.fixture.status.elapsed;
                    const homeGoals = match.goals.home;
                    const awayGoals = match.goals.away;
                    const fixtureId = match.fixture.id;

                    if(matches.length > 5) updateStatus(`Scanning Match ${i+1} of ${matches.length}...`);

                    if (elapsed >= 70 && Math.abs(homeGoals - awayGoals) <= 1) {
                        const stats = await getMatchStats(fixtureId);
                        if (stats) {
                            analyzeAndRender(match, stats);
                            potentialTips++;
                        }
                    }
                }

                statusDiv.style.display = 'none';
                if (potentialTips > 0) playAlertSound(); 
                if (potentialTips === 0) { resultsDiv.innerHTML = "<p style='text-align:center;'>No active matches fit the criteria.</p>"; }

            } catch (err) { showError("Connection Error."); }
        }

        async function getMatchStats(fixtureId) {
            await new Promise(r => setTimeout(r, 200)); 
            try {
                const response = await fetch(`https://v3.football.api-sports.io/fixtures/statistics?fixture=${fixtureId}`, {
                    "method": "GET",
                    "headers": { "x-apisports-key": API_KEY }
                });
                const data = await response.json();
                return data.response; 
            } catch (e) { return null; }
        }

        function analyzeAndRender(match, statsData) {
            if (!statsData || statsData.length < 2) return; 

            const getStat = (teamStats, type) => {
                try {
                    const stat = teamStats.statistics.find(s => s.type === type);
                    if (!stat || stat.value === null) return 0;
                    if (type === "Ball Possession") return parseInt(stat.value);
                    if (type === "expected_goals") return parseFloat(stat.value);
                    return stat.value;
                } catch(e) { return 0; }
            };

            const homeStats = statsData[0];
            const awayStats = statsData[1];
            const hxg = getStat(homeStats, "expected_goals");
            const axg = getStat(awayStats, "expected_goals");
            const hasXG = (hxg > 0 || axg > 0); 
            const hShots = getStat(homeStats, "Total Shots");
            const aShots = getStat(awayStats, "Total Shots");
            const hSot = getStat(homeStats, "Shots on Goal");
            const aSot = getStat(awayStats, "Shots on Goal");

            const calcPressure = (s, sot, totalShots) => {
                let score = 0;
                score += getStat(s, "Corner Kicks") * 3;
                score += sot * 4; 
                score += getStat(s, "Shots insidebox") * 2;
                score += (getStat(s, "Dangerous Attacks") * 0.5); 
                
                if (totalShots > 5 && (sot / totalShots) < 0.3) score -= 5;
                const totalAttacks = getStat(s, "Total attacks") || 1;
                const dangAttacks = getStat(s, "Dangerous Attacks");
                if ((dangAttacks / totalAttacks) > 0.7) score += 5;
                if (getStat(s, "Ball Possession") > 65) score += 5;
                return score;
            };

            let homeP = calcPressure(homeStats, hSot, hShots);
            let awayP = calcPressure(awayStats, aSot, aShots);
            const totalP = homeP + awayP;

            // --- STARS & STAKE ---
            let stars = "‚≠ê‚≠ê";
            let unitStake = "0.5u";
            if (totalP > 30) { stars = "‚≠ê‚≠ê‚≠ê"; unitStake = "0.5u"; }
            if (totalP > 45) { stars = "‚≠ê‚≠ê‚≠ê‚≠ê"; unitStake = "1u"; }
            if (totalP > 60) { stars = "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"; unitStake = "2u (MAX)"; }

            // --- MARKET ---
            let market = "Wait";
            let homeCornerAlert = (homeP > 30 && hShots > 0 && (hSot/hShots) < 0.35);
            let awayCornerAlert = (awayP > 30 && aShots > 0 && (aSot/aShots) < 0.35);
            if (homeCornerAlert || awayCornerAlert) market = "OVER CORNERS";
            if (totalP > 45) market = "NEXT GOAL";

            let hCrumbling = (getStat(homeStats, "Goalkeeper saves") >= 5 && getStat(homeStats, "Shots insidebox") >= 8);
            let aCrumbling = (getStat(awayStats, "Goalkeeper saves") >= 5 && getStat(awayStats, "Shots insidebox") >= 8);
            if (hCrumbling) market = "AWAY TEAM GOAL";
            if (aCrumbling) market = "HOME TEAM GOAL";

            // --- SAVE HISTORY ---
            if(totalP > 30) {
                saveToHistory(match, market, stars);
            }

            // --- BADGES ---
            let badges = [];
            if (getStat(homeStats, "Red Cards") > 0) { awayP += 20; badges.push(`<span class="badge badge-red">RED: HOME</span>`); }
            if (getStat(awayStats, "Red Cards") > 0) { homeP += 20; badges.push(`<span class="badge badge-red">RED: AWAY</span>`); }
            if (hCrumbling) badges.push(`<span class="badge badge-purple">üß± HOME CRUMBLING</span>`);
            if (aCrumbling) badges.push(`<span class="badge badge-purple">üß± AWAY CRUMBLING</span>`);

            let homeTilt = 50;
            if (totalP > 0) homeTilt = (homeP / totalP) * 100;
            let likelihood = totalP > 25 ? "Medium" : "Low";
            if (totalP > 50 || badges.length > 0) likelihood = "High";
            if (totalP < 15 && badges.length === 0) return; 

            // STORE TIP
            const copyText = `üö® *InPlay Alert*\n‚öΩ ${match.teams.home.name} vs ${match.teams.away.name}\n${stars} | Stake: ${unitStake}\nüéØ Market: ${market}\nüìà Pressure: ${Math.floor(totalP)}`;
            window.MATCH_TIPS[match.fixture.id] = copyText;

            const card = document.createElement('div');
            card.className = `card likelihood-${likelihood}`;
            
            const xgDisplay = hasXG 
                ? `<div class="stat-item"><span class="stat-label highlight-stat">xG</span> <span class="highlight-stat">${hxg.toFixed(2)} - ${axg.toFixed(2)}</span></div>` 
                : `<div class="stat-item"><span class="stat-label">xG</span> <span>N/A</span></div>`;

            card.innerHTML = `
                <div class="match-header">
                    <span>${match.league.name}</span>
                    <span class="star-rating">${stars}</span>
                    <span style="color:#fff; font-weight:bold;">${match.fixture.status.elapsed}'</span>
                </div>
                
                <div class="team-row"><div class="team-info"><img src="${match.teams.home.logo}" class="team-logo"> ${match.teams.home.name}</div><div class="score">${match.goals.home}</div></div>
                <div class="team-row"><div class="team-info"><img src="${match.teams.away.logo}" class="team-logo"> ${match.teams.away.name}</div><div class="score">${match.goals.away}</div></div>
                
                <div class="tilt-container">
                    <div class="tilt-home" style="width: ${homeTilt}%"></div>
                    <div class="tilt-away" style="width: ${100 - homeTilt}%"></div>
                </div>

                <div class="advisor-box">
                    <div><div style="color:#94a3b8; font-size:0.8em;">RECOMMENDED</div><div class="market-tag">${market}</div></div>
                    <div><div style="color:#94a3b8; font-size:0.8em;">STAKE</div><div class="stake-tag">${unitStake}</div></div>
                </div>

                <div class="badge-container">${badges.join('')}</div>

                <div class="stats-grid">${xgDisplay}
                    <div class="stat-item"><span class="stat-label">Shots (On Target)</span> <span>${hShots}(${hSot}) - ${aShots}(${aSot})</span></div>
                    <div class="stat-item"><span class="stat-label">Shots (In Box)</span> <span>${getStat(homeStats, "Shots insidebox")} - ${getStat(awayStats, "Shots insidebox")}</span></div>
                    <div class="stat-item"><span class="stat-label">Corners</span> <span>${getStat(homeStats, "Corner Kicks")} - ${getStat(awayStats, "Corner Kicks")}</span></div>
                    <div class="stat-item"><span class="stat-label">Pressure Idx</span> <span>${Math.floor(homeP)} - ${Math.floor(awayP)}</span></div>
                </div>
                
                <div class="tools-row">
                    <button class="btn-tool btn-copy" onclick="copyTip(${match.fixture.id})">üìã Copy</button>
                    <a href="https://www.bet365.com/#/IP/B1" target="_blank" style="width:100%; display:block;"><button class="btn-tool btn-bet" style="width:100%">üöÄ Bet365</button></a>
                    <button class="btn-tool btn-win" onclick="recordResult('win')">‚úÖ</button>
                    <button class="btn-tool btn-loss" onclick="recordResult('loss')">‚ùå</button>
                </div>
            `;
            resultsDiv.appendChild(card);
        }

        // --- SCHEDULE ---
        async function checkSchedule() {
            resultsDiv.innerHTML = '<p style="text-align:center;">Checking schedule...</p>';
            errorDiv.style.display = 'none';
            statusDiv.style.display = 'none';
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`https://v3.football.api-sports.io/fixtures?date=${today}`, {
                    "method": "GET",
                    "headers": { "x-apisports-key": API_KEY }
                });
                const data = await response.json();
                if (data.errors && Object.keys(data.errors).length > 0) { showError("Daily Limit Reached."); return; }

                const matches = data.response;
                const scheduleLeagues = [...LEAGUES.major, ...LEAGUES.goals];
                const validStatuses = ['NS', '1H', 'HT', '2H', 'ET', 'P', 'FT'];
                
                const upcomingMatches = matches.filter(m => {
                    const isMajor = scheduleLeagues.includes(m.league.id) || m.league.type === 'Cup';
                    return isMajor && validStatuses.includes(m.fixture.status.short);
                });

                if (upcomingMatches.length === 0) { resultsDiv.innerHTML = "<h3>üìÖ Schedule</h3><p>No key games today.</p>"; return; }
                upcomingMatches.sort((a, b) => new Date(a.fixture.date) - new Date(b.fixture.date));

                let html = `<h3>‚è∞ Scan Times (Kickoff + 85m)</h3>`;
                upcomingMatches.forEach(m => {
                    let kickOff = new Date(m.fixture.date);
                    kickOff.setMinutes(kickOff.getMinutes() + 85); 
                    const scanTimeDisplay = kickOff.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    let statusColor = '#94a3b8'; 
                    if(['1H','HT','2H','ET'].includes(m.fixture.status.short)) statusColor = '#ef4444';
                    
                    const startStr = kickOff.toISOString().replace(/-|:|\.\d\d\d/g, ""); 
                    const endTime = new Date(kickOff);
                    endTime.setMinutes(endTime.getMinutes() + 15);
                    const endStr = endTime.toISOString().replace(/-|:|\.\d\d\d/g, "");
                    const eventTitle = `Scan: ${m.teams.home.name} vs ${m.teams.away.name}`;
                    const calUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventTitle)}&dates=${startStr}/${endStr}&details=Check+InPlay+App+Now!`;

                    html += `
                        <div style="background:#334155; padding:10px; margin-bottom:6px; border-radius:6px; font-size:0.9em; border-left: 4px solid #0f766e; display:flex; justify-content:space-between; align-items:center;">
                            <div><span style="color:#2dd4bf; font-weight:bold; font-size:1.1em;">${scanTimeDisplay}</span> <span style="color:${statusColor}; font-weight:bold; font-size:0.8em;">[${m.fixture.status.short}]</span><br><span style="color:#fff;">${m.teams.home.name} vs ${m.teams.away.name}</span></div>
                            <a href="${calUrl}" target="_blank" style="text-decoration:none;"><button style="background:#0f766e; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer;">üîî</button></a>
                        </div>`;
                });
                resultsDiv.innerHTML = html;
            } catch (error) { showError("Connection Error."); }
        }
    </script>
</body>
</html>
